var ComboBox=function(a,b){this.container=a,this.container.className+=" cb--container",this.input=a.getElementsByTagName("input")[0],this.input.className+=" cb--input",this.select=a.getElementsByTagName("select")[0],this.select.className+=" cb--select",this.value=this.input.value;var c=document.createElement("option");c.innerHTML="---",this.select.insertBefore(c,this.select.options[0]),this.options=this.select.options;for(var d=0;d<this.options.length;d++){var e=this.options[d];e.className+=" cb--option"}this.input.setAttribute("aria-label","Special inputfield with "+this.options.length+" prefilled options available, use the down/up arrow keys to chose one or write your own text."),this.select.setAttribute("aria-hidden","true"),this.addEventListeners(),this.createVisualHint(),this.hideSelect(),b||this.setStyles()};ComboBox.prototype.addEventListeners=function(){return this.input.addEventListener("focus",this.showSelect.bind(this)),this.input.addEventListener("blur",this.hideSelect.bind(this)),this.input.addEventListener("keyup",this.handleInput.bind(this)),this.select.addEventListener("focus",this.showSelect.bind(this)),this.select.addEventListener("change",this.handleSelection.bind(this)),this.select.addEventListener("keydown",this.handleSelection.bind(this)),this.select.addEventListener("click",function(a){this.handleSelection(a,"click")}.bind(this)),this.select.addEventListener("blur",function(a){this.hideSelect(),this.preventTriggerSelection?this.preventTriggerSelection=!1:this.triggerSelection()}.bind(this)),this},ComboBox.prototype.handleInput=function(a){var b=this.getKey(a);return"ArrowDown"===b?(this.handleWriting(a.target.value),this.select.focus()):"Escape"===b?this.hideSelect():"Enter"!==b||this.preventDoubleEnter?(this.preventDoubleEnter=!1,this.handleWriting(this.input.value)):(this.setValue(this.select.value,"hideSelect"),this.triggerSelection("force")),this},ComboBox.prototype.handleWriting=function(a){this.value=a;var b=this.isTextInOptions(a,this.options);return b&&""!=a?(this.setOptionZero(a),this.select.value=b,a.length===b.length&&this.triggerSelection()):this.select.value=this.setOptionZero(a),this},ComboBox.prototype.isTextInOptions=function(a,b){for(var c=1,d=b.length;c<d;c++)if(a.toLowerCase()==b[c].value.substring(0,a.length).toLowerCase())return b[c].innerHTML;return!1},ComboBox.prototype.setOptionZero=function(a){var b=""!=a?"--- "+a:"---";return this.options[0].innerHTML=b,b},ComboBox.prototype.handleSelection=function(a,b){var c=this.getKey(a);return"Escape"===c?(this.preventTriggerSelection=!0,this.setValue(this.options[0].value,"hideSelect"),this.handleWriting(this.value)):"Enter"===c?(this.preventDoubleEnter=!0,this.setValue(a.target.value,"hideSelect")):this.setValue(a.target.value,!1),b&&this.triggerSelection("force"),this},ComboBox.prototype.setValue=function(a,b){return a&&""!=a?("---"!=a.substring(0,3)?this.input.value=a:this.input.value=a.substring(4,a.length),b&&(this.input.focus(),this.hideSelect()),this.value=this.input.value,this):this},ComboBox.prototype.getKey=function(a){return!!a&&("Enter"===a.key||"Enter"===a.code||13===a.keyCode?"Enter":"Escape"===a.key||"Escape"===a.code||27===a.keyCode?"Escape":"ArrowDown"===a.key||"ArrowDown"===a.code||40===a.keyCode?"ArrowDown":void 0)},ComboBox.prototype.hideSelect=function(){return this.select.setAttribute("aria-hidden","true"),this.container.style.overflow="hidden",this.select.style.top="0",this.select.style.left="-10000px",this.select.style.pointerEvents="none",this.select.style.opacity=0,this},ComboBox.prototype.showSelect=function(){return this.select.setAttribute("aria-hidden","false"),this.container.style.overflow="visible",this.select.style.top="100%",this.select.style.left="0",this.select.style.pointerEvents="all",this.select.style.opacity=1,this},ComboBox.prototype.createVisualHint=function(){this.hint=document.createElement("span"),this.hint.setAttribute("aria-hidden","true"),this.hint.className="cb--hint",this.hint.innerHTML="â–¼",this.container.insertBefore(this.hint,this.input)},ComboBox.prototype.setStyles=function(){this.container.style.display="inline-block",this.container.style.verticalAlign="top",this.container.style.position="relative",this.container.style.overflow="hidden",this.input.style.boxSizing="border-box",this.input.style.height="100%",this.input.style.width="100%",this.select.style.border="1px solid lightgrey",this.select.style.borderTop="0",this.select.style.position="absolute",this.select.style.top="100%",this.select.style.width="100%",this.hint.style.fontSize="8px",this.hint.style.pointerEvents="none",this.hint.style.position="absolute",this.hint.style.right="5%",this.hint.style.top="50%",this.hint.style.lineHeight="0.1",this.select.tabIndex=-1,this.select.size=4},ComboBox.prototype.onSelect=function(a){return this.cb=a,this.handleInput(this.value),this},ComboBox.prototype.triggerSelection=function(a){return(a||this.value!==this.previousValue)&&(this.cb(this),this.previousValue=this.value),this};